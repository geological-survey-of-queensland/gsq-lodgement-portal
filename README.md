# GSQ Lodgement Portal

## Context

Resource authority (RA, or "permit") holders need to submit a range of statutory reports on their activities to the Queensland Government (QGov). Reports cover all commodities, survey types and associated infrastructure, at every stage of the project lifecycle from planning and exploration, through to production and operations, and finally closure and abandonment. When QGov issues a permit, the legislation requires the permit holder to submit reports to the Department when certain activities are performed under the conditions of the permit. The style and contents of the report to QGov varies depending on the nature of the activity being reporting upon. 

These reports are highly valuable to the Geological Survey of Queensland (GSQ) since they provide oversight of geoscience-related activities within Queensland, with an especial focus on knowledge of georesources. Most industry reports have a confidentiality period before becoming open file, which then allows any member of the public anywhere in the world to access, discover, view, and utilise this information for their own activities, thus building upon the geoscientific knowledge of Queensland.    

## The Lodgement Portal

The [GSQ Lodgement Portal](https://geolodgement.dnrme.qld.gov.au/) establishes a single online portal for industry and GSQ to lodge Queensland georesources reports, as well as providing data validation at point of data entry. Data from submitted reports is automatically stored within [Amazon S3](https://aws.amazon.com/s3/), and associated metadata within the [GeoProperties Database](https://github.com/geological-survey-of-queensland/geological-properties-database). Both data and metadata are used internally for QGov business activities and, when the confidentality period lapses, published on the external-facing [Open Data Portal](https://geoscience.data.qld.gov.au/).

All reports submitted are auto-assigned a Persistent Identifier (PID) that remains fixed over time. Specific report activities such asm but not limited to, geophysical surveys or boreholes are also assigned separate PIDs to more readily identify those specific data and metadata sources.  

### Character Limitations
To ensure information entered into the Lodgement Portal can be stored and parsed effectively in the geoproperties database, certain character limitations are enforced.
- Titles are limited to alphanumeric characters (A-Z a-z 0-9), spaces( ), dashes(-), fullstops(.), forward-slash(/) and commas(,)
- Descriptions are limited to alphanumeric characters (A-Z a-z 0-9), spaces( ), line breaks and common punctuation [].,!@?'$%()*=-_–~;:/&+"\
- To insert a new line in the description, a double line break (double enter) must be used during input
- Non-standard characters can be identified using a UTF-8 decoder such as [UTF-8 Decoder](https://www.browserling.com/tools/utf8-decode).
- To troubleshoot complex inputs, use a decoder and replace problem characters with a UTF-8 equivalent, such as changing ” to ".

## Lodgement Portal activity diagram

<p align="center">
<img src="https://github.com/geological-survey-of-queensland/gsq-lodgement-portal/blob/master/images/MVP-report-lodgement-activity-diagram.png" width="70%"><br>
Figure 1: MVP Lodgement Portal activity diagram</p>

## Lodgement Portal conceptual data model

<p align="center">
<img src="https://github.com/geological-survey-of-queensland/gsq-lodgement-portal/blob/master/images/lodgement-portal-conceptual-design.png" width="100%"><br>
Figure 2: Lodgement Portal conceptual data model</p>

## Lodgement Portal data elements

|Element|Field name|Remarks|Source|
|---|---|---|---|
|report_id|Report ID|A unique, persistent identifer|System|
|report_alias|Report alias|An alternative identifier for the report. Digital Object Identifier will be recorded here.|System|
|report_title|Report title|A textual name|Text|
|report_description|Report description|A textual description of the report|Text|
|report_type|Report type|Lookup to controlled list of report types|Vocab|
|report_status|Report status|Lookup to controlled list of status|Vocab|
|report_permit|Permit|The permit number(s) covered by the report|Lookup|
|report_is_of_feature|Geoadmin feature|The features targeted in the report|Lookup|
|report_is_of_site|Site|The sites targeted in the report|Lookup|
|report_is_of_suvey|Generated by|The PID of the survey or other activity that generated the report|Lookup|
|report_data_category|Earth science data category|The data categories featured in the report|Vocab|
|report_commodity|Commodity|The target or actual commodities featured in the report|Vocab|
|report_owner|Report owner|Party that owns the resource<br>A lookup to controlled list of organisations|Lookup|
|report_author|Author|Party who authored the resource|Text|
|report_submitter|Submitter|The logged-in user who lodged the report|System|
|report_start_time|Report period start date|The temporal coverage of the report|Date|
|report_end_time|Report period end date|The temporal coverage of the report|Date|
|report_lodge_time|Created|Date and time the report was lodged (date of receipt)|System Date|
|report_open_file_date|Issued|Date of formal issuance (open file publication). Calculated for new reports.|Date|
|report_access_rights|Data access rights|Controls user and system access to the resource|Vocab|
|report_geometry|Geometry|Spatial coverage of the report. If no spatial data is submitted with the report and the report is for a permit(s), the spatial coverage is created based on the permit extents boundary.|Geometry|
|report_details|Report details|Report-specific additional information|Key:Values|
|report_dataset|Dataset link|Links to related datasets including raw data|Hyperlink|

### Report_alias data elements (sub-table)

|Element|Field name|Remarks|Source|
|---|---|---|---|
|report_alias|Report alias|An alternative identifier for the report|User|
|report_alias_source|Alias source|The source of the alternative identifier, e.g. Digital Object Identifier|User|
|report_alias_detail|Alias detail|Details of the alias in textual form|User|

### Report_status data elements (sub-table)

|Element|Field name|Remarks|Source|
|---|---|---|---|
|report_status|Report status|Lookup to controlled list of status. In the MVP, this will default to "Submitted".|Lookup|
|status_start_date|(hidden)|The date the status was set|System|
|status_end_date|(hidden)|The date the previous status ended|System|

### Geometry data elements (sub-table)

The spatial coverage of the report. If no spatial data is submitted with the report and the report is for a permit(s), the spatial coverage is created based on the permit extents boundary. The geometry is stored in the PostGIS component of the database.

|Element|Field name|Remarks|Source|
|---|---|---|---|
|geometry_id|Geometry ID|The identifier of the geometry to allow retrieval of the geometrty.|WKT|
|geometry_format|Geometry format|The format of the geometry: a point, a line, a polygon, etc.|WKT|

### Report_details data elements (sub-table)

Enables the collection of various data, held as key:value pairs, i.e. report_detail_type:report_detail_value. e.g. tectonic:Kalkadoon

|Element|Field name|Remarks|Source|
|---|---|---|---|
|report_detail_type|Report detail type|Report-specific additional information type|Vocab|
|report_detail_value|Report detail value|Report-specific additional information in textual or numeric form|User|

### Dataset_resource data elements (sub-table)

The datasets submitted with the report, e.g. PDF files, wireline logs, CSV files, are stored as objects in S3. Each resource is described with DCAT2-compliant metadata. This table lists all of the dataset resources linked to a report.

|Element|Field name|Remarks|Source|
|---|---|---|---|
|dct:identifier|PID|Persistent identifier for the resource|System|
|dct:title|Title|A name given to the item|User|
|dct:description|Description|A free-text account of the item.|User|
|dct:type|Resource type|The nature of the resource, e.g. LAS file|Vocab|
|dct:format|Format|The file format, physical medium, or dimensions of the resource.|User|
|dct:byteSize|Byte size|The size of the resource in bytes|System|
|dct:dateSubmitted|Date submitted|Date of submission of the resource|System|

## Report Types 

Those reports covered by the Lodgement Portal can be found in the [Petroleum & Gas Reporting Practice Direction](https://www.resources.qld.gov.au/__data/assets/pdf_file/0020/1512074/reporting-practice-direction-petroleum.pdf) and the [Mineral & Coal Reporting Practice Direction](https://www.resources.qld.gov.au/__data/assets/pdf_file/0019/1512073/reporting-practice-direction-minerals-coal.pdf). In addition to these report types, activity, production and statistical notices are also submitted through the Lodgement Portal.

## Lodgement Portal vocabularies

The vocabularies used in this profile are:

1. [Georesources Report Type](https://vocabs.gsq.digital/vocabulary/georesource-report)
2. [Earth Science Data Category](https://vocabs.gsq.digital/vocabulary/earth-science-data-category) - the category(s) of data contained in the report
3. [Data Access Rights](https://vocabs.gsq.digital/vocabulary/data-access-rights)
4. [Commodity](https://vocabs.gsq.digital/vocabulary/gsq-commodity)
5. Report detail type.
6. Report status.

## Lodgement Portal authentication and authorisation

The Lodgement Portal requires authentication using the Identity Broker:

* External users authenticate using their Queensland Government (QGov) login.
* Internal users authenticate using Microsoft's Active Directory Federation Services (ADFS).

The Lodgement Portal requires user authorisation:

* External users have rights to submit lodgement forms
* Internal users have rights to submit lodgement forms or view lodged forms

<p align="center">
<img src="https://github.com/geological-survey-of-queensland/gsq-lodgement-portal/blob/master/images/lodgement-portal-authentication-authorisation.png" width="60%"><br>
Figure 3: Lodgement Portal external user authentication and authorisation</p>

## See also

* [Industry report profile](https://github.com/geological-survey-of-queensland/industry-report-profile)  


## License

This code repository's content are licensed under the [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/), the deed of which is stored in this repository here: [LICENSE](LICENSE).

## Contacts
*System owner*:  
**Mark Gordon**,
Geological Survey of Queensland,
Department of Resources,
Brisbane, QLD, Australia,
<mark.gordon@resources.qld.gov.au>  

*Contributors*:  
**Vance Kelly**,
Principal Data Manager,
Geological Survey of Queensland,
Department of Resources,
Brisbane, QLD, Australia,  
<vance.kelly@resources.qld.gov.au>

**Luke Hauck**,
Geoscientist,
Geological Survey of Queensland,
Department of Resources,
Brisbane, QLD, Australia,
<luke.hauck@resources.qld.gov.au>
